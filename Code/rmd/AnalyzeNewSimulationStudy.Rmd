---
title: "Stats 572 - Simulation Study Comparison"
author: "Simon Dovan Nguyen"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: true
    theme: lumen
    css: assets/styles.css
---

# Set Up

## Libr.
```{r}
library(stats)
library(tidyverse)
library(StatMatch)
library(xtable)
library(lmtest)
library(sandwich)
```

## Rm. Var.
```{r}
rm(list=ls())
dir = "/Users/simondn/Documents/Stats572/"
```

## Functions
```{r}
source(paste0(dir,"Code/AIZResults.R"))
source(paste0(dir,"Code/DiscrepancyFunction.R"))
source(paste0(dir,"Code/MonteCarloResults.R"))
source(paste0(dir,"Code/SimulationReformatResultsFunction.R"))
```

## Results

```{r}
file_list = list.files(path =  paste0(dir,"Results/Linear/N500_2000"), 
                        pattern = "\\.rds$", 
                        full.names = TRUE)
data_list = list()
data_list = lapply(file_list, readRDS)
rm(file_list)
# names(data_list) = paste0("Case",1:length(data_list))
```


```{r}
### Set Up ###
SettingType = "Linear"
AIZ = AIZResults(type = SettingType)
SimulationResultsReformatted = SimulationReformatResultsFunction(data_list)
SimSEMedianList = SimulationResultsReformatted$SimSEMedianList 
MonteCarloREsults = MonteCarloResults(SimulationResultsReformatted, 5)
RunTimeList = SimulationResultsReformatted$RunTimeList # in seconds
CoverageList = data.frame(SimulationResultsReformatted$CoverageList)
ParameterVector = SimulationResultsReformatted$ParameterVector
CoverageList = cbind(ParameterVector,CoverageList)
```

## Reformat
```{r}
AIZ = AIZ %>% mutate(Misspec. = case_when(Misspec. == "No" ~ 0,
                                          Misspec. == "Yes" ~ 1),
                     Homo. = case_when(Homo. == "Yes" ~ 0,
                                       Homo. == "No" ~ 0.5),
                     Leverage = case_when(Leverage == "No" ~ 0,
                                          Leverage == "Yes" ~ 0.1),)
```


# Standard Errors
```{r}
SEComparison500 = full_join(AIZ[,c(1:5,10:12)], filter(SimSEMedianList, SS == 500), 
                            by = c("Misspec.", "Homo.", "Leverage", "K")) %>%
  select(Misspec.,
         Homo.,
         SS.x,
         Leverage,
         K,
         MedianSEPop,
         MedianSECond,
         Difference.x,
         Population,
         Conditional,
         Difference.y) %>%
  rename(SS = SS.x,
         PopSE_N50_200 = MedianSEPop,
         CondSE_N50_200 = MedianSECond,
         Difference_N50_200 = Difference.x,
         PopSE_N500_2000 = Population,
         CondSE_N500_2000 = Conditional,
         Difference_N500_2000 = Difference.y) %>%
  mutate(Indicator = 1*(abs(Difference_N50_200)>=abs(Difference_N500_2000))) %>%
  select(Misspec.,
         Homo.,
         SS,
         Leverage,
         K,
         Difference_N50_200,
         Difference_N500_2000,
         Indicator)

SEComparison2000 = full_join(AIZ[,c(1:5,10:12)], filter(SimSEMedianList,SS == 2000), 
                            by = c("Misspec.", "Homo.", "Leverage", "K")) %>%
  select(Misspec.,
         Homo.,
         SS.x,
         Leverage,
         K,
         MedianSEPop,
         MedianSECond,
         Difference.x,
         Population,
         Conditional,
         Difference.y) %>%
  rename(SS = SS.x,
         PopSE_N50_200 = MedianSEPop,
         CondSE_N50_200 = MedianSECond,
         Difference_N50_200 = Difference.x,
         PopSE_N500_2000 = Population,
         CondSE_N500_2000 = Conditional,
         Difference_N500_2000 = Difference.y) %>%
  mutate(Indicator = 1*(abs(Difference_N50_200)>=abs(Difference_N500_2000))) %>%
  select(Misspec.,
         Homo.,
         SS,
         Leverage,
         K,
         Difference_N50_200,
         Difference_N500_2000,
         Indicator)
```

```{r}
SEComparison500
SEComparison2000
```


# Coverage
```{r}
CoverageThetaPop = CoverageList %>% 
  select(Misspec.,
         Homo.,
         SS,
         Leverage,
         K,
         ThetaPop_VPop,
         ThetaPop_VCond) %>%
  mutate(ThetaPopDifference = ThetaPop_VPop - ThetaPop_VCond) %>%
  filter(SS == 500)

CoverageThetaCond = CoverageList %>% 
  select(Misspec.,
         Homo.,
         SS,
         Leverage,
         K,
         ThetaCond_VPop,
         ThetaCond_VCond) %>%
  mutate(ThetaPopDifference = ThetaCond_VPop - ThetaCond_VCond) %>%
  filter(SS == 500)
```

